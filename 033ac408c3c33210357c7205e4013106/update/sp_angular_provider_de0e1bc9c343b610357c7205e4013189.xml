<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_angular_provider">
    <sp_angular_provider action="INSERT_OR_UPDATE">
        <name>casitaMultilineEllipsisTooltip</name>
        <script><![CDATA[//usage : <XYZ ec-ellipsis-tooltip ec-ellipsis-tooltip-title="" ec-ellipsis-tooltip-data-toggle="" ec-ellipsis-tooltip-data-placement="" ec-ellipsis-tooltip-data-container="" />
//Default : ec-ellipsis-tooltip-title -> '' ec-ellipsis-tooltip-data-toggle -> 'tooltip' ec-ellipsis-tooltip-data-placement -> 'auto' ec-ellipsis-tooltip-data-container -> 'body' 
function ecMultilineEllipsisTooltip(i18n, $rootScope) {
    "use strict";
    return {
        restrict: 'A',
        link: function(scope, elem, attrs) {
            angular.element(document).ready(function() {
                setTimeout(function() {
                    showTooltip(elem, attrs);
                }, 100);
            });
            // window resize should recalculate if tooltip is required, 
            // currently the tooltip attribute does not work on window resize or text zoom
            $(window).resize(function(e) {
                if(e.type == 'resize') {
                    showTooltip(elem, attrs);
                }
            });

            //destroy the tooltip when directive scope ends
            scope.$on('$destroy', function() {
              elem.tooltip('destroy');
            });

            // To show tooltip for ellipsis without page reload on enabling text-spacing for WCAG testing
            scope.$watch(
               function () {
                  return elem.css("line-height");
               },
               function (newVal, oldVal) {
                  if (newVal !== oldVal) {
                     showTooltip(elem, attrs);
                  }
            });

            function showTooltip(element, attrs) {
                if (element && element.length > 0) {
                    if (isEllipsisActive(element.get(0))) {
                        var title = attrs.ecEllipsisTooltipTitle ? attrs.ecEllipsisTooltipTitle : '';
                        var html = (attrs.ecEllipsisTooltipDataHtml === 'true');
                        var dataToggle = attrs.ecEllipsisTooltipDataToggle ? attrs.ecEllipsisTooltipDataToggle : 'tooltip';
                        var dataPlacement = attrs.ecEllipsisTooltipDataPlacement ? attrs.ecEllipsisTooltipDataPlacement : 'auto';
                        var dataContainer = attrs.ecEllipsisTooltipDataContainer ? attrs.ecEllipsisTooltipDataContainer : 'body';

                        element.attr('title', title);
                        if (html)
                            element.attr('data-html', 'true');
                        element.attr('data-toggle', dataToggle);
                        element.attr('data-placement', dataPlacement);
                        element.attr('data-container', dataContainer);
                    }
                    else {
                        // if ellipsis is not active need to remove the title and data-toggle related attribute,
                        // to have consistent behaviour also removes malformed attributes.
                        element.removeAttr('title');
                        element.removeAttr('data-html');
                        element.removeAttr('data-toggle');
                        element.removeAttr('data-placement');
                        element.removeAttr('data-container');
                    }
                }
            }

            function getInnerDimensions(node) {
                var computedStyle = getComputedStyle(node);
                var horizontalPadding = parseFloat(computedStyle.paddingLeft) + parseFloat(computedStyle.paddingRight);
                var verticalPadding = parseFloat(computedStyle.paddingTop) + parseFloat(computedStyle.paddingBottom);
                var horizontalBorder = parseFloat(computedStyle.borderLeftWidth) + parseFloat(computedStyle.borderRightWidth);
                var verticalBorder = parseFloat(computedStyle.borderTopWidth) + parseFloat(computedStyle.borderBottomWidth);

                // offsetWidth and offsetHeight include padding and border, so we need to remove the padding and border and return dimensions
                return {
                    offsetWidth: node.offsetWidth - horizontalPadding - horizontalBorder,
                    offsetHeight: node.offsetHeight - verticalPadding - verticalBorder
                };
            }

            function containsLargerChildren(parent) {
                var innerDimensions = getInnerDimensions(parent);
                var parentWidth = innerDimensions.offsetWidth; // minus padding
                var parentHeight = innerDimensions.offsetHeight; // minus padding
                var children = parent.children;

                for (var i=0; i<children.length; i++) {
                    var child = children[i];
                    if ((child.offsetWidth > parentWidth || child.offsetHeight > parentHeight)
                      || (child.children.length && containsLargerChildren(child)))
                        return true;
                }

                return false;
            }

            function isEllipsisActive(element) {
                return (element.clientWidth < element.scrollWidth || element.clientHeight < element.scrollHeight) ? true : (element.children.length > 0 ? containsLargerChildren(element) : false);
              }
            }
        };
    }]]></script>
        <sys_class_name>sp_angular_provider</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2026-02-12 14:53:30</sys_created_on>
        <sys_id>de0e1bc9c343b610357c7205e4013189</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>casitaMultilineEllipsisTooltip</sys_name>
        <sys_package display_value="Casita" source="033ac408c3c33210357c7205e4013106">033ac408c3c33210357c7205e4013106</sys_package>
        <sys_policy/>
        <sys_scope display_value="Casita">033ac408c3c33210357c7205e4013106</sys_scope>
        <sys_update_name>sp_angular_provider_de0e1bc9c343b610357c7205e4013189</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2026-02-12 14:53:30</sys_updated_on>
        <type>directive</type>
    </sp_angular_provider>
</record_update>
